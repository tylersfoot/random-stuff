[gd_scene load_steps=19 format=3 uid="uid://dpwpnpkqjvmse"]

[ext_resource type="Script" path="res://player.gd" id="1_grkg6"]
[ext_resource type="Shader" path="res://alternateuniverse.gdshader" id="1_m0g3j"]
[ext_resource type="Script" path="res://alternate_universe_canvas.gd" id="2_4txtv"]
[ext_resource type="Texture2D" uid="uid://de4fvnnelnx2u" path="res://assets/steamuserimages-a.akamaihd.jpg" id="2_qxboy"]
[ext_resource type="Script" path="res://density_map_canvas.gd" id="4_052dx"]
[ext_resource type="Texture2D" uid="uid://c4r2csjh3hrvw" path="res://assets/arrow.png" id="5_20r2d"]
[ext_resource type="PackedScene" uid="uid://bvf5tupcqyrc0" path="res://Metaball.tscn" id="6_qbcpy"]
[ext_resource type="Script" path="res://metaball_manager.gd" id="7_c3ouw"]
[ext_resource type="Shader" path="res://metaball.gdshader" id="7_nxwt3"]
[ext_resource type="Script" path="res://metaball_render.gd" id="8_5eqfi"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_86gap"]
shader = ExtResource("1_m0g3j")
shader_parameter/animation_time = null
shader_parameter/parallax = null
shader_parameter/colors = null
shader_parameter/canvas_size = null
shader_parameter/screen_size = null
shader_parameter/scale = null

[sub_resource type="ShaderMaterial" id="ShaderMaterial_o7mlm"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_o0h1x"]

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_ndeyv"]
blend_mode = 1

[sub_resource type="ShaderMaterial" id="ShaderMaterial_0mg3f"]
shader = ExtResource("7_nxwt3")
shader_parameter/screen_size = null
shader_parameter/outline_color = null
shader_parameter/virtual_resolution = Vector2(200, 100)
shader_parameter/density_threshold = 0.3
shader_parameter/outline_radius = null

[sub_resource type="ViewportTexture" id="ViewportTexture_pbo18"]
viewport_path = NodePath("ScreenViewportContainer/ScreenViewport/Node2D/DensityMapViewport")

[sub_resource type="ViewportTexture" id="ViewportTexture_mfgta"]
viewport_path = NodePath("ScreenViewportContainer/ScreenViewport")

[sub_resource type="Environment" id="Environment_2s5xq"]
background_mode = 3
glow_enabled = true
glow_intensity = 0.61
glow_strength = 1.15
glow_blend_mode = 0
glow_hdr_threshold = 1.74
glow_hdr_scale = 0.0
glow_hdr_luminance_cap = 256.0
glow_map_strength = 1.0

[node name="Node2D" type="Node2D"]

[node name="ScreenViewportContainer" type="SubViewportContainer" parent="."]
offset_right = 40.0
offset_bottom = 40.0

[node name="ScreenViewport" type="SubViewport" parent="ScreenViewportContainer"]
transparent_bg = true
handle_input_locally = false
size = Vector2i(640, 360)
render_target_update_mode = 4

[node name="Node2D" type="Node2D" parent="ScreenViewportContainer/ScreenViewport"]

[node name="AlternateUniverseViewport" type="SubViewport" parent="ScreenViewportContainer/ScreenViewport/Node2D"]
transparent_bg = true
handle_input_locally = false
size = Vector2i(640, 360)
render_target_update_mode = 4

[node name="AlternateUniverseCanvas" type="ColorRect" parent="ScreenViewportContainer/ScreenViewport/Node2D/AlternateUniverseViewport" node_paths=PackedStringArray("player")]
material = SubResource("ShaderMaterial_86gap")
offset_right = 640.0
offset_bottom = 360.0
script = ExtResource("2_4txtv")
player = NodePath("../../PlayerCanvasLayer/Player")

[node name="AlternateUniverseViewportContainer" type="SubViewportContainer" parent="ScreenViewportContainer/ScreenViewport/Node2D"]
material = SubResource("ShaderMaterial_o7mlm")
offset_right = 640.0
offset_bottom = 360.0

[node name="Background" type="TextureRect" parent="ScreenViewportContainer/ScreenViewport/Node2D"]
offset_right = 1920.0
offset_bottom = 1080.0
scale = Vector2(0.36184, 0.363585)
size_flags_horizontal = 3
size_flags_vertical = 3
texture = ExtResource("2_qxboy")

[node name="DensityMapViewportContainer" type="SubViewportContainer" parent="ScreenViewportContainer/ScreenViewport/Node2D"]
material = SubResource("ShaderMaterial_o0h1x")
offset_right = 100.0
offset_bottom = 100.0

[node name="DensityMapViewport" type="SubViewport" parent="ScreenViewportContainer/ScreenViewport/Node2D"]
transparent_bg = true
handle_input_locally = false
msaa_2d = 3
screen_space_aa = 1
size = Vector2i(640, 360)
render_target_update_mode = 4

[node name="DensityMapCanvas" type="Node2D" parent="ScreenViewportContainer/ScreenViewport/Node2D/DensityMapViewport" node_paths=PackedStringArray("metaball_manager")]
material = SubResource("CanvasItemMaterial_ndeyv")
script = ExtResource("4_052dx")
metaball_manager = NodePath("../../MetaballManager")

[node name="MetaballManager" type="Node2D" parent="ScreenViewportContainer/ScreenViewport/Node2D" node_paths=PackedStringArray("density_map_canvas")]
script = ExtResource("7_c3ouw")
metaball_scene = ExtResource("6_qbcpy")
density_map_canvas = NodePath("../DensityMapViewport/DensityMapCanvas")

[node name="MetaballCanvasLayer" type="CanvasLayer" parent="ScreenViewportContainer/ScreenViewport/Node2D"]

[node name="MetaballRender" type="Sprite2D" parent="ScreenViewportContainer/ScreenViewport/Node2D/MetaballCanvasLayer" node_paths=PackedStringArray("density_map_viewport", "alternate_universe_viewport", "player")]
material = SubResource("ShaderMaterial_0mg3f")
texture = SubResource("ViewportTexture_pbo18")
offset = Vector2(320, 180)
script = ExtResource("8_5eqfi")
density_map_viewport = NodePath("../../DensityMapViewport")
alternate_universe_viewport = NodePath("../../AlternateUniverseViewport")
player = NodePath("../../PlayerCanvasLayer/Player")

[node name="PlayerCanvasLayer" type="CanvasLayer" parent="ScreenViewportContainer/ScreenViewport/Node2D"]

[node name="Player" type="CharacterBody2D" parent="ScreenViewportContainer/ScreenViewport/Node2D/PlayerCanvasLayer" node_paths=PackedStringArray("metaball_manager", "alternate_universe_viewport", "density_map_viewport", "screen_viewport", "metaball_render")]
z_index = 2
script = ExtResource("1_grkg6")
metaball_manager = NodePath("../../MetaballManager")
alternate_universe_viewport = NodePath("../../AlternateUniverseViewport")
density_map_viewport = NodePath("../../DensityMapViewport")
screen_viewport = NodePath("../../..")
metaball_render = NodePath("../../MetaballCanvasLayer/MetaballRender")

[node name="Sprite2D" type="Sprite2D" parent="ScreenViewportContainer/ScreenViewport/Node2D/PlayerCanvasLayer/Player"]
rotation = 1.5708
scale = Vector2(0.05, 0.05)
texture = ExtResource("5_20r2d")

[node name="Sprite2D" type="Sprite2D" parent="."]
texture = SubResource("ViewportTexture_mfgta")
offset = Vector2(320, 180)

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_2s5xq")
