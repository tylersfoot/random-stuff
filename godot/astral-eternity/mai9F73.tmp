[gd_scene load_steps=14 format=3 uid="uid://dpwpnpkqjvmse"]

[ext_resource type="Script" path="res://player.gd" id="1_grkg6"]
[ext_resource type="Texture2D" uid="uid://bdf4ddqdnmlhd" path="res://assets/Free-Sky-with-Clouds-Background-Pixel-Art8.jpg" id="2_nd155"]
[ext_resource type="Script" path="res://density_map_canvas.gd" id="4_052dx"]
[ext_resource type="Texture2D" uid="uid://c4r2csjh3hrvw" path="res://assets/arrow.png" id="5_20r2d"]
[ext_resource type="PackedScene" uid="uid://bgwxh8ugi1kgi" path="res://alternateuniverse.tscn" id="5_xtsx3"]
[ext_resource type="PackedScene" uid="uid://bvf5tupcqyrc0" path="res://Metaball.tscn" id="6_qbcpy"]
[ext_resource type="Script" path="res://metaball_manager.gd" id="7_c3ouw"]
[ext_resource type="Shader" path="res://metaball.gdshader" id="7_nxwt3"]
[ext_resource type="Script" path="res://metaball_render.gd" id="8_5eqfi"]

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_ndeyv"]
blend_mode = 1

[sub_resource type="ShaderMaterial" id="ShaderMaterial_o0h1x"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_0mg3f"]
shader = ExtResource("7_nxwt3")
shader_parameter/screen_size = null
shader_parameter/outline_color = null
shader_parameter/virtual_resolution = Vector2(200, 100)
shader_parameter/density_threshold = 0.3
shader_parameter/outline_radius = null

[sub_resource type="ViewportTexture" id="ViewportTexture_pbo18"]
viewport_path = NodePath("DensityMapViewport")

[node name="Node2D" type="Node2D"]

[node name="AlternateUniverseViewportContainer" type="SubViewportContainer" parent="."]
offset_right = 2000.0
offset_bottom = 1000.0

[node name="AlternateUniverseViewport" type="SubViewport" parent="AlternateUniverseViewportContainer"]
handle_input_locally = false
size = Vector2i(640, 360)
render_target_update_mode = 4

[node name="AlternateUniverseContent" parent="AlternateUniverseViewportContainer/AlternateUniverseViewport" instance=ExtResource("5_xtsx3")]

[node name="Background" type="TextureRect" parent="."]
offset_left = -17.0
offset_top = -70.0
offset_right = 2089.0
offset_bottom = 1192.0
scale = Vector2(0.347284, 0.391105)
size_flags_horizontal = 3
size_flags_vertical = 3
texture = ExtResource("2_nd155")

[node name="DensityMapViewport" type="SubViewport" parent="."]
transparent_bg = true
handle_input_locally = false
msaa_2d = 3
screen_space_aa = 1
size = Vector2i(640, 360)
render_target_update_mode = 4

[node name="DensityMapCanvas" type="Node2D" parent="DensityMapViewport" node_paths=PackedStringArray("metaball_manager")]
material = SubResource("CanvasItemMaterial_ndeyv")
script = ExtResource("4_052dx")
metaball_manager = NodePath("../../MetaballManager")

[node name="DensityMapViewportContainer" type="SubViewportContainer" parent="."]
material = SubResource("ShaderMaterial_o0h1x")
offset_right = 100.0
offset_bottom = 100.0

[node name="MetaballManager" type="Node2D" parent="." node_paths=PackedStringArray("density_map_canvas")]
script = ExtResource("7_c3ouw")
metaball_scene = ExtResource("6_qbcpy")
density_map_canvas = NodePath("../DensityMapViewport/DensityMapCanvas")

[node name="MetaballCanvasLayer" type="CanvasLayer" parent="."]
visible = false

[node name="MetaballRender" type="Sprite2D" parent="MetaballCanvasLayer" node_paths=PackedStringArray("density_map_viewport", "alternate_universe_viewport")]
material = SubResource("ShaderMaterial_0mg3f")
texture = SubResource("ViewportTexture_pbo18")
offset = Vector2(1000, 500)
script = ExtResource("8_5eqfi")
density_map_viewport = NodePath("../../DensityMapViewport")
alternate_universe_viewport = NodePath("../../AlternateUniverseViewportContainer/AlternateUniverseViewport")

[node name="PlayerCanvasLayer" type="CanvasLayer" parent="."]

[node name="Player" type="CharacterBody2D" parent="PlayerCanvasLayer" node_paths=PackedStringArray("metaball_manager", "alternate_universe_viewport", "density_map_viewport")]
z_index = 2
script = ExtResource("1_grkg6")
metaball_manager = NodePath("../../MetaballManager")
alternate_universe_viewport = NodePath("../../AlternateUniverseViewportContainer/AlternateUniverseViewport")
density_map_viewport = NodePath("../../DensityMapViewport")

[node name="Sprite2D" type="Sprite2D" parent="PlayerCanvasLayer/Player"]
rotation = 1.5708
scale = Vector2(0.2, 0.2)
texture = ExtResource("5_20r2d")
